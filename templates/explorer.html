{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Marketplace</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'explorer.css' %}">
  <!-- <link rel = "stylesheet" href = "explorer.css"> -->
</head>
<body>
  <header class="dashboard">
    <div class="logo">Logo</div>
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search listings...">
      <button onclick="handleSearch()"><span class="material-icons">search</span></button>
    </div>
    <div class="user-actions">
      <div class="account-wrapper">
        <a href="#" class="account-btn" id="accountBtn"><span class="material-icons">account_circle</span> Account</a>
        <div class="account-dropdown" id="accountDropdown">
          <a href="{% url 'my_listings' %}" class="dropdown-item">My Listings</a>
          <a href="{% url 'logoutpage' %}" class="dropdown-item">Logout</a>
          <!-- <a href="#" class="dropdown-item">Logout</a> -->
        </div>
      </div>
      <a href="#" class="cart-btn"><span class="material-icons">shopping_cart</span> <span id="cartCount">0</span></a>
    </div>
  </header>

  <div class="container">
    <aside class="sidebar">
      <ul>
        <li class="active"><a href="{% url 'explorer' %}">Home</a></li>
        <li><a href="{% url 'my_listings' %}">My Listings</a></li>
        <li><a href="{% url 'create_listing' %}" class="create-listing-btn">Create Listing</a></li>
      </ul>
    </aside>

    <main class="main-content">
      <h1>Hello {{ user.username }}! Welcome to the Campus Mart</h1>
      <p>
        Explore listings, connect with peers, and manage your transactions. You're now part of a student-driven community designed to meet your needs. It's 01:30 PM +06 on Saturday, May 24, 2025â€”start your day with us!
      </p>

      <section class="listings-section">
        <div class="listings-header">
          <h3>Listings</h3>
          <a href="{% url 'create_listing' %}" class="create-listing-btn">Create Listing</a>
        </div>

        <div class="filter-bar">
          <select id="categoryFilter">
            <option value="">All Categories</option>
            <optgroup label="Electronics">
              <option value="mobile">Mobile</option>
              <option value="laptop">Laptop</option>
              <option value="powerbank">Powerbank</option>
              <option value="headphones">Headphones</option>
              <option value="other_electronics">Other Electronics</option>
            </optgroup>
            <optgroup label="Books">
              <option value="textbooks">Textbooks</option>
              <option value="novels">Novels</option>
              <option value="study_guides">Study Guides</option>
            </optgroup>
            <optgroup label="Services">
              <option value="tutoring">Tutoring</option>
              <option value="freelance">Freelance</option>
              <option value="other_services">Other Services</option>
            </optgroup>
          </select>
          <select id="priceFilter">
            <option value="">All Prices</option>
            <option value="0-50">$0 - $50</option>
            <option value="51-100">$51 - $100</option>
            <option value="101-200">$101 - $200</option>
            <option value="201+">$201+</option>
          </select>
          <select id="conditionFilter">
            <option value="">All Conditions</option>
            <option value="new">New</option>
            <option value="like_new">Like New</option>
            <option value="used">Used</option>
            <option value="refurbished">Refurbished</option>
          </select>
          <select id="universityFilter">
            <option value="">All Universities</option>
            <option value="iut">IUT</option>
            <option value="du">DU</option>
            <option value="buet">BUET</option>
            <option value="ru">RU</option>
            <option value="cu">CU</option>
            <option value="bu">BU</option>
            <option value="ruet">RUET</option>
          </select>
          <select id="transactionTypeFilter">
            <option value="">All Transaction Types</option>
            <option value="buy">Buy</option>
            <option value="rent">Rent</option>
            <option value="exchange">Exchange</option>
          </select>
        </div>

        <div class="listings-grid">
          {% for listing in listings %}
          <div class="listing-card">
            {% if listing.images.exists %}
            <img src="{{ listing.images.first.image.url }}" alt="{{ listing.title }}" class="listing-image">
            {% endif %}
            <h4>{{ listing.title }}</h4>
            <p>{{ listing.description|truncatewords:20 }}</p>
            <p class="price">${{ listing.price }}</p>
            <p class="visibility">Visible to: {{ listing.university }} Students</p>
            <a href="{% url 'listing_detail' listing.pk %}" class="view-details-btn">View Details</a>
          </div>
          {% empty %}
          <div class="no-listings">
            <p>No listings available. Be the first to create one!</p>
            <a href="{% url 'create_listing' %}" class="create-listing-btn">Create Listing</a>
          </div>
          {% endfor %}
        </div>
      </section>

      <section class="section">
        <h3>Notifications</h3>
        <p>You have no new notifications. Start exploring or list your own items!</p>
      </section>

      <section class="section">
        <h3>Community Updates</h3>
        <p>Join discussions and stay updated with campus events.</p>
      </section>
    </main>
  </div>

<script src="{% static 'explorer.js' %}"></script>
<!-- <script src = "explorer.js"></script> -->
</body>
</html>